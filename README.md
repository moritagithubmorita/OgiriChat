# 『OgiriChat』

## サイト概要

  このサイトでは、マッチングした対戦者とリアルタイムで大喜利対決ができます。

### 具体的な内容

- リアルタイムチャット形式で回答を投稿
- ナイス機能で評価
- 視聴のみの「観覧モード」も存在

### サイトテーマ

  「OgiriChat」は他人と自分のユーモアセンスをチャット形式で競うリアルタイム大喜利サイトです。

### テーマを選んだ理由

  私はかねてよりお笑いが好きなのですが、それをどうにか形にしたいと考えておりました。お笑いは「素早く面白く」が本質であると考えています。これを機能として実装できればより本質的なお笑いの場をインターネット上に作ることができると考えました。人と関わるのがあまり得意でない人でも、様々な事情で他人と会いづらい状況の人でもお笑いを楽しめるようなサイトを作ろうと思いました。

### ターゲットユーザ
  ターゲットとなるユーザは主に以下の特徴に当てはまる人です。

  - 大喜利愛好家
  - お笑いに興味がある人
  - お笑い探求者
  - 対人ではうまくボケられないが文字に起こしてでなら才能を発揮できる人

### 主な利用シーン

通勤通学、仕事の休憩時間、主婦の休憩、塾の休憩と言ったようなスキマ時間に、大喜利対戦で自分の腕を磨きたいなと思った時などです。

## 設計書

### ◆ 大喜利対戦について

- お題は１ルーム3問
- 掲示板のように回答を投稿し、リアルタイムでお互いに評価します。
- 回答の横にいいねボタンが表示されます。
- 自分のいいねボタンも押せます。
- お題は重複しません。
- 制限時間を設け、経過すると終了です。
- リザルトページでは自分のボケの一覧を表示します。リザルトページの閲覧は任意です。
- お題はチャットルーム作成時に未出題のものからランダムで決定します。

### ◆ マッチメイクについて

- 2人揃った時点でマッチメイク成立とする
- お題が不足してルームを取得できない場合は「準備中画面」を表示します。お題が新規追加されない限り、当サイトの利用は実質できない状態になります。

### ◆ ユーザーランクについて

- ナイスの獲得数に応じてランクアップします。
- 駆け出し→探求者→腕利き→ベテラン→マスターの5段階
- 対戦終了後、リザルトページで"昇格確認"のダイアログが表示され、昇格するか辞退するか選べます。この辞退機能はスターのために用意されたものです。
- 1対戦についき1階級しか昇格できないすなわち、飛び級は禁止します。次回対戦終了後、再び昇格確認のダイアログが表示されます。
- 隠し要素として、ベテラン→マスターへの昇格を5回辞退するとユーザーネームの上に星マークが表示されるようになる。
- 降格も可能。降格はマイページから行う。なお、降格した後で元のランクに戻すには再びナイスを獲得し昇格する必要があります。

### ◆ 用語の定義

- ユーザー...登録済み利用者(非管理者)
- 管理者...管理者ページにアクセスできる人間
- 管理者側ページ
- ユーザ側ページ
- スター...隠し要素です。ユーザーがベテランからマスターへの昇格を5回"辞退する"と得られる称号のようなもので、事あるごとにユーザーネームの右横に「星のマーク」が表示されるようになります。消すことはできません。

### ◆ 各種ステータス

#### QuestionRoom
- お題ステータス(is_active)...有効(true)/無効(false)
- 出題ステータス(is_set)...出題済み(true)/未出題(false)
- ルームステータス(room_status)...enumで定義。standby(0)/matching(1)/running(2)/finished(3)
#### User
- 会員ステータス(is_active)...有効(true)/無効(false)
- 会員ランク(rank)...enumで定義。"駆け出し"fledgling(0)/"探求者"seeker(1)/"腕利き"skilful(2)/"ベテラン"veteran(3)/"マスター"master(4)
- スターカウンタ(star_count)...ベテラン→マスターの辞退回数をカウント。0→5まで変化。デフォルトは0。
#### Notice
- 既読ステータス(is_readed)...既読(true)/未読(false)
#### Inquiry
- 既読ステータス(is_readed)...既読(true)/未読(false)
- 解決ステータス(is_solved)...解決(true)/未解決(false)

### ◆ ユーザーフロー

- ログインしないとトップ画面以外見れません。
- ログイン → トップ → マッチメイク → 対戦画面 → ねぎらい画面 → リザルト詳細画面 → トップ

### ◆ 管理者フロー

- ログインしないとトップ画面以外見れません。
- ログイン → トップ(お題一覧) → お題追加 → お題詳細 → 一覧(トップ)

### ◆ 実装機能

- ユーザ側実装機能
  - ログイン/ログアウト/退会
  - メアドとパスワードでログイン
  - ユーザのログイン情報はActionCableで利用するためcookieに保存する。
  - メアド、名前、パスワードで登録
  - マイページで自身の情報閲覧、編集画面で編集ができます。
  - 未ログインではトップ画面/ログイン/新規登録以外見れません。
  - 退会でき、退会するとログインできません。
  - ユーザは対戦画面で回答を複数個生成できます。0個以上、上限はありません。
  - 観覧機能。観覧者もナイスを押せます。
  - フォロー及び通知機能
  - お問い合わせフォーム。ユーザネーム、件名、本文で構成されます。送信ボタンでデータベースに送られ、管理者に届きます。
- 管理者側実装機能
  - 回答者のアカウントはデータベースに事前に登録しておきます。
  - ログイン/ログアウト
  - メアドとパスワードでログイン
  - 未ログインではトップ画面/ログインしか見れません。
  - 会員の情報を一覧表示、詳細表示、編集できます(有効/退会も変更可能)。
  - 検索機能(「会員名」「お題」「回答」を「部分一致」で検索)
  - お題(QuestionRoom)を追加、一覧表示、詳細表示、お題編集、削除ができます。
  - お問い合わせ一覧表示、詳細表示
  - 未読のお問い合わせがあるとドットを表示します。
- 細かいところ
  - 一覧表示を行うページは新着から表示します。
- 追加機能
  - 観覧機能...対戦画面に第三者が入れます。対戦の行く末を見届けることができ、また、回答横のいいねボタンを押せます。閲覧者人数も表示します。
  - フォロー&通知機能...気に入ったユーザをフォローできます。フォローしたユーザが対戦を開始すると通知が届きます。
  - お問い合わせ機能...ユーザ側に問い合わせ画面を作り、管理者側に届く仕様にします。
  - 検索機能...管理者のみの機能。問い合わせ対応のためにお題や回答を検索します。検索は「回答者名」、「お題」、「回答」の３つに対して「部分一致」で行われます。
  - 管理者のお題編集、削除...削除は物理削除で行います。お題をあらかじめ登録しておく仕様上、削除と無効化(is_active: false)は明確に区別します。
  - 複数問出題
  - ユーザーランク
  - 現実時間とお題の出題時間を同期...現実世界の10分おきにマッチメイクを可能とします。(例: 15時〜15時9分99秒...マッチメイク可能 → 15時10分〜15時19分99秒...マッチメイク不可)  これによりマッチメイクの成功率を上げます。
## チャレンジ要素一覧

<https://docs.google.com/spreadsheets/d/1Ih8hVnbY6StXFywB7ikIzIcPBtDey1bz1mq0QQAnDaw/edit#gid=0>

## 開発環境

- OS：macOS Big Sur ver.11.4
- 言語：HTML,CSS,JavaScript,Ruby
- フレームワーク：Ruby on Rails
- JS ライブラリ：jQuery
- IDE：Cloud9

